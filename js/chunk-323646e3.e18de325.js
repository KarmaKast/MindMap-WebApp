(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-323646e3"],{"11ca":function(t,e,i){"use strict";var s=i("b664"),o=i.n(s);o.a},b664:function(t,e,i){},fde5:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{ref:"entityContainer",style:e.entityContainerStyleFinal},[s("div",{staticClass:"relSpotsContainer",style:{position:"absolute"}},[s("div",{staticClass:"selfSpots"},[e.showSpots.left?s("div",{staticClass:"relSpotLeft selfSpot",style:e.relSelfSpotsLeftStyle}):e._e(),e.showSpots.bottom?s("div",{staticClass:"relSpotBottom selfSpot",style:e.relSelfSpotsBottomStyle}):e._e(),e.showSpots.right?s("div",{staticClass:"relSpotRight selfSpot",style:e.relSelfSpotsRightStyle}):e._e(),e.showSpots.top?s("div",{staticClass:"relSpotTop selfSpot",style:e.relSelfSpotsTopStyle}):e._e()]),s("div",{staticClass:"targetSpots"},e._l(e.relTargetSpotsStyles,(function(t,e){return s("div",{key:e,staticClass:"targetSpot",style:t})})),0)]),s("div",{staticClass:"relationWires",style:e.relationWiresStyle},[s("v-stage",{attrs:{config:{width:this.relStageSize.width,height:this.relStageSize.height}}},[s("v-layer",e._l(e.entityData.source.RelationClaims,(function(t,i){return s("v-group",{key:i},[s("v-line",{attrs:{config:e.relationLineConfigs[t.To]}})],1)})),1)],1)],1),s("div",{staticClass:"relationLabelsContainer",style:{position:"absolute"}},e._l(e.entityData.source.RelationClaims,(function(t,e){return s("div",{key:e,staticClass:"relationLabel"})})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:e.entitySelectedFinal,expression:"entitySelectedFinal"}],staticClass:"entityUI",style:{position:"absolute",display:"grid"}},[s("div",{directives:[{name:"touch",rawName:"v-touch:tap.self",value:e.editentityLabel,expression:"editentityLabel",arg:"tap",modifiers:{self:!0}}],staticClass:"editLabelBttn",style:{position:"absolute",bottom:"5px",height:"25px",width:"25px",backgroundColor:"#ad37de",borderRadius:"50%",pointerEvents:"all"}},[e.editingLabel?s("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.entityLabel,expression:"entityLabel",modifiers:{lazy:!0}}],ref:"labelInput",style:e.inputTextStyle,attrs:{type:"text"},domProps:{value:e.entityLabel},on:{input:function(t){e.entityLabel=t.target.value},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editentityLabel(t)},change:function(t){e.entityLabel=t.target.value}}}):e._e()]),e._e(),s("div",{directives:[{name:"touch",rawName:"v-touch:tap.self",value:function(){t.$emit("removeEntity",t.entityID)},expression:"\n        () => {\n          this.$emit('removeEntity', this.entityID);\n        }\n      ",arg:"tap",modifiers:{self:!0}}],staticClass:"removeEntityBttn",style:{position:"absolute",left:"30px",bottom:"5px",height:"25px",width:"25px",backgroundColor:"#ff1a02",borderRadius:"50%",pointerEvents:"all"}}),s("div",{directives:[{name:"touch",rawName:"v-touch:start.self",value:e.toggleRelClaimMode,expression:"toggleRelClaimMode",arg:"start",modifiers:{self:!0}}],staticClass:"startRelClaimBttn",style:{position:"absolute",top:"14px",left:e.relationSpots.right-e.relationSpots.left+5+"px",height:"25px",width:"25px",backgroundColor:"blue",borderRadius:"50%",pointerEvents:"all"}})],1),s("div",{directives:[{name:"touch",rawName:"v-touch:start.self",value:e.startdrag,expression:"startdrag",arg:"start",modifiers:{self:!0}},{name:"touch",rawName:"v-touch:end",value:e.confirmRelClaimTarget,expression:"confirmRelClaimTarget",arg:"end"}],staticClass:"entity",style:e.entityStyle},[s("p",{style:e.entityTextStyle},[e._v(e._s(e.entityLabel))])])])},o=[],n=(i("e260"),i("cca6"),i("2532"),i("ddb0"),i("2b0e")),a=i("bc3a"),r=i.n(a),l=i("b383"),h=i.n(l),p=i("63ea"),d=i.n(p),c={name:"entityComponent",components:{},props:{colors:Object,entityID:{type:String,required:!0},apiUrl:String,apiValidity:Boolean,canvasSize:{height:Number,width:Number},canvasLocation:Object,canvasMousePos:Object,autoSave:{default:!1,type:Boolean},grid:Object,defaultColors:Object,dragging:{default(){return{state:!1}},type:Object},pressed:{default(){return{state:!1}},type:Object},relationSpotsOffset:{default:7,type:Number},entitySelected:{default:void 0,type:Boolean},entityLocationDef:{default(){return{x:0,y:0,z:0}},type:Object},targetRelSpots:Object,updateEntityData:{default:!1,type:Boolean}},data:function(){return{minHeight:60,minWidth:120,entityLocation:this.entityLocationDef,entityLocationProcessed:{},entityLabel:"",entitySelectedDef:void 0,entitySelectedFinal:this.entitySelected,entityColor:{h:0,s:0,l:0,a:1},entityData:{source:{Label:"",RelationClaims:[]},viz_props:{location:{x:0,y:0,z:0},color:{h:166,s:89,l:45,a:1}}},entitySize:{height:60,width:160},entityBoundingBoxSize:{height:0,width:0},draggingDeltas:{x:0,y:0},editingLabel:!1,relClaimMode:{mode:!1,targetID:null},entityContainerStylePartStatic:{position:"absolute",boxSizing:"border-box",display:"grid",padding:"4px",outline:"none"},relationLineConfigs:{}}},computed:{relWireColor:function(){return`hsla(${this.colors["backgroundShade1"].h},${this.colors["backgroundShade1"].s}%,${this.colors["backgroundShade1"].l}%, 1)`},entityContainerStylePart1:function(){return{minWidth:(""===this.entityLabel?this.minWidth:0)+"px",minHeight:(""===this.entityLabel?this.minHeight:0)+"px",zIndex:this.dragging.state||this.entitySelectedFinal?"5000":"initial",borderRadius:this.entitySize["height"]>this.entitySize["width"]?this.entitySize["height"]+"px":this.entitySize["width"]+"px",boxShadow:`${this.dragging.state||this.entitySelectedFinal?`hsla(${this.entityColor.h},0%,${this.colors["backgroundShade1"].l}%,0.2) 0px 0px 0px 4px, `:""} inset 0px 0px 0 4px hsla(${this.entityColor.h},\n        ${this.entityColor.s}%,\n        ${this.colors["backgroundShade1"].l}%, 0.2)`}},entityContainerStylePart2:function(){return{top:this.canvasSize.height/2+this.entityLocation_.y-this.entityBoundingBoxSize.height/2+"px",left:this.canvasSize.width/2+this.entityLocation_.x-this.entityBoundingBoxSize.width/2+"px"}},entityContainerStyleFinal:function(){return Object.assign({},this.entityContainerStylePartStatic,this.entityContainerStylePart1,this.entityContainerStylePart2,{transform:`translate(\n          ${this.canvasLocation.x+"px"},\n          ${this.canvasLocation.y+"px"}\n        )`})},entityStyle:function(){return{position:"relative",borderRadius:"inherit",border:`1px solid hsla(${this.entityColor.h},${this.entityColor.s}%, ${this.entityColor.l}%, 0.8)`,backdropFilter:"blur(2px)",cursor:this.dragging.state?"grabbing":"grab",backgroundColor:CSS.supports("backdrop-filter: blur(3px)")?this.editingLabel&&this.entitySelectedFinal?"white":`hsla(0,0%,${this.colors["background"].l+5}%,0.2)`:this.editingLabel&&this.entitySelectedFinal?"white":`hsla(0,0%,${this.colors["background"].l+5}%,1)`,pointerEvents:"all",display:"grid",placeItems:"center",boxSizing:"border-box",padding:"10px 15px 10px 15px"}},entityTextStyle:function(){return{pointerEvents:"none",margin:"0px",maxWidth:"100px",overflowWrap:"break-word",color:`hsla(${this.entityColor.h},${this.entityColor.s}%, ${this.entityColor.l}%, 1)`,background:"none",border:"none",userSelect:"none"}},inputTextStyle:function(){return{position:"absolute",bottom:"20px",left:"20px"}},entityLocation_:function(){let t={};return this.canvasMousePos&&this.pressed.state?(t.x=this.canvasMousePos.x-this.canvasSize.width/2,t.y=this.canvasMousePos.y-this.canvasSize.height/2,this.grid.snap&&(t.x=(Math.floor((t.x-this.grid.size/2)/this.grid.size)+1)*this.grid.size,t.y=(Math.floor((t.y-this.grid.size/2)/this.grid.size)+1)*this.grid.size)):t=Object.assign({},this.entityLocation),t},relationWiresStylePart1:function(){return{position:"absolute",left:0-this.canvasSize.width/2-this.entityLocation_.x+this.entityBoundingBoxSize.width/2,top:0-this.canvasSize.height/2-this.entityLocation_.y+this.entityBoundingBoxSize.height/2,pointerEvents:"none",position:"absolute"}},relationWiresStyle:function(){return Object.assign({},this.relationWiresStylePart1,{left:this.relationWiresStylePart1.left-this.canvasLocation.x+"px",top:this.relationWiresStylePart1.top-this.canvasLocation.y+"px"})},relationSpots:function(){return{left:this.entityLocation_.x-this.entityBoundingBoxSize.width/2-this.relationSpotsOffset,right:this.entityLocation_.x+this.entityBoundingBoxSize.width/2+this.relationSpotsOffset,top:this.entityLocation_.y-this.entityBoundingBoxSize.height/2-this.relationSpotsOffset,bottom:this.entityLocation_.y+this.entityBoundingBoxSize.height/2+this.relationSpotsOffset}},relationWirePointsPart1:function(){let t={};for(const i of this.entityData.source.RelationClaims){let s=this.targetRelSpots?this.targetRelSpots[i.To]:void 0;if(s&&this.relationSpots){function e(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}const o=(this.relationSpots.top+this.relationSpots.bottom)/2,n=(this.relationSpots.left+this.relationSpots.right)/2,a=(s.top+s.bottom)/2,r=(s.left+s.right)/2;s={left:{x:s.left,y:a},top:{x:r,y:s.top},right:{x:s.right,y:a},bottom:{x:r,y:s.bottom}};let l,h,p={left:{x:this.relationSpots.left,y:o},top:{x:n,y:this.relationSpots.top},right:{x:this.relationSpots.right,y:o},bottom:{x:n,y:this.relationSpots.bottom}};for(const t in s)for(const i in p){const o=e(s[t],p[i]);(void 0===l||o<l)&&(l=o,h={target:t,self:i})}t[i.To]={points:[p[h.self].x,p[h.self].y,s[h.target].x,s[h.target].y],selfSpot:h.self}}else t[i.To]={points:[0,0,0,0],selfSpot:"left"}}return t},relTargetSpotsStylePart1:function(){return{position:"absolute",height:2*this.relationSpotsOffset+"px",width:2*this.relationSpotsOffset+"px",border:"1px solid "+this.relWireColor,borderRadius:"50%",boxSizing:"border-box"}},relTargetSpotsStyles:function(){const t=[];return this.relationWirePointsPart1&&Object.entries(this.relationWirePointsPart1).forEach(([e,i])=>{t.push(Object.assign({},this.relTargetSpotsStylePart1,{top:i.points[3]-i.points[1]+(["left","right"].includes(i.selfSpot)?this.entityBoundingBoxSize.height/2-this.relationSpotsOffset:["bottom"].includes(i.selfSpot)?this.entityBoundingBoxSize.height:2*-this.relationSpotsOffset)+"px",left:i.points[2]-i.points[0]+(["top","bottom"].includes(i.selfSpot)?this.entityBoundingBoxSize.width/2-this.relationSpotsOffset:["right"].includes(i.selfSpot)?this.entityBoundingBoxSize.width:2*-this.relationSpotsOffset)+"px"}))}),t},showSpots(){const t={left:!1,bottom:!1,right:!1,top:!1};return Object.entries(this.relationWirePointsPart1).forEach(([e,i])=>{t[i.selfSpot]=!0}),t},relationWirePointsPart2:function(){const t={};return this.relationWirePointsPart1&&Object.entries(this.relationWirePointsPart1).forEach(([e,i])=>{const s=this.relationSpotsOffset,o=i.points,n=Math.sqrt(Math.pow(o[2]-o[0],2)+Math.pow(o[3]-o[1],2)),a=s/n;t[e]=[o[0],o[1],(1-a)*o[2]+a*o[0],(1-a)*o[3]+a*o[1]]}),t},relationWirePointsPart3:function(){const t={};return this.relationWirePointsPart2&&Object.entries(this.relationWirePointsPart2).forEach(([e,i])=>{t[e]=[i[0]+this.canvasLocation.x,i[1]+this.canvasLocation.y,i[2]+this.canvasLocation.x,i[3]+this.canvasLocation.y]}),t},relationWirePoints:function(){const t={};return this.relationWirePointsPart3&&Object.entries(this.relationWirePointsPart3).forEach(([e,i])=>{t[e]=[i[0]+this.canvasSize.width/2,i[1]+this.canvasSize.height/2,i[2]+this.canvasSize.width/2,i[3]+this.canvasSize.height/2]}),t},relStageSize:function(){return this.canvasSize},relSelfSpotsStylePart1:function(){return{height:"4px",width:"4px",backgroundColor:""+this.relWireColor,boxSizing:"border-box"}},relSelfSpotsLeftStyle:function(){return Object.assign({},this.relSelfSpotsStylePart1,{top:(this.relationSpots.bottom-this.relationSpots.top)/2-this.relationSpotsOffset-2+"px",left:-this.relationSpotsOffset-2+"px"})},relSelfSpotsBottomStyle:function(){return Object.assign({},this.relSelfSpotsStylePart1,{bottom:-this.relationSpotsOffset-2-this.entityBoundingBoxSize.height+"px",left:(this.relationSpots.right-this.relationSpots.left)/2-this.relationSpotsOffset-2+"px"})},relSelfSpotsRightStyle:function(){return Object.assign({},this.relSelfSpotsStylePart1,{top:(this.relationSpots.bottom-this.relationSpots.top)/2-this.relationSpotsOffset-2+"px",right:-this.relationSpotsOffset-2-this.entityBoundingBoxSize.width+"px"})},relSelfSpotsTopStyle:function(){return Object.assign({},this.relSelfSpotsStylePart1,{top:-this.relationSpotsOffset-2+"px",left:(this.relationSpots.right-this.relationSpots.left)/2-this.relationSpotsOffset-2+"px"})}},methods:{startdrag(t){if(([1].includes(t.which)||"touchstart"===t.type)&&!this.pressed.state){var e=this.$refs.entityContainer.getBoundingClientRect();"mousedown"===t.type?(this.draggingDeltas["x"]=t.clientX-e.x-this.canvasLocation.x,this.draggingDeltas["y"]=t.clientY-e.y-this.canvasLocation.y):"touchstart"==t.type&&(this.draggingDeltas["x"]=t.touches[0].clientX-e.x,this.draggingDeltas["y"]=t.touches[0].clientY-e.y),this.$emit("setStartingCanvasMousePos",t),this.$emit("entityActivated",t,this.entityID)}},getEntityData(){r()({method:"GET",url:this.apiUrl+"/entity/get",params:{entityID:this.entityID},paramsSerializer:h.a.stringify}).then(t=>{this.entityData.source=t.data[0],this.entityData.viz_props=t.data[1].Data,this.$emit("setSelfRelSpots",this.relationSpots);for(const e of this.entityData.source.RelationClaims)this.$emit("assignTargetRelSpots",e.To)})},savePropToAPI(t,e){r()({method:"POST",baseURL:this.apiUrl,url:"/entity/updateProps/",params:{entityID:this.entityID},paramsSerializer:h.a.stringify,data:h.a.stringify({props:JSON.stringify({[t]:e})})}).then(()=>{this.entityData.viz_props[t]=e instanceof Object?Object.assign({},e):e,this.autoSave&&r.a.post(this.apiUrl+"/collection/save")})},updateEntityBoundaryBox(t=100){setTimeout(()=>{var t=this.$refs.entityContainer.getBoundingClientRect();this.entityBoundingBoxSize={width:t.width,height:t.height},this.$emit("setSelfRelSpots",this.relationSpots)},t)},editentityLabel(t){this.editingLabel=!this.editingLabel,this.editingLabel&&setTimeout(()=>{this.$refs.labelInput.focus()},100)},toggleRelClaimMode(){this.relClaimMode.mode=!this.relClaimMode.mode,this.$store.commit("update_relClaimMode",{mode:this.relClaimMode.mode,targetID:this.relClaimMode.targetID,claimantID:this.entityID})},confirmRelClaimTarget(t){t.preventDefault(),!this.relClaimMode.mode&&this.$store.state.relClaimMode.mode&&(t.type,this.$store.commit("update_relClaimMode",{mode:!0,targetID:this.entityID,claimantID:this.$store.state.relClaimMode.claimantID}))},addRelClaim(){r()({method:"POST",baseURL:this.apiUrl,url:"/entity/addRelClaim",data:h.a.stringify({claimantID:this.entityID,targetID:this.relClaimMode.targetID})}).then(t=>{this.relClaimMode.mode=!1,this.relClaimMode.targetID=null,this.$store.commit("update_relClaimMode",this.relClaimMode);const e=this.entityData;e.source.RelationClaims.push(JSON.parse(t.data.relClaim)),this.entityData=Object.assign({},e),this.$emit("assignTargetRelSpots",JSON.parse(t.data.relClaim).To)})}},watch:{apiValidity(){},canvasLocation:{handler(){},deep:!0},entitySelected:{handler(){this.entitySelectedFinal=!!this.entitySelected},deep:!0},relationSpots(){this.$emit("setSelfRelSpots",this.relationSpots)},relationWirePoints(){Object.entries(this.relationWirePoints).forEach(([t,e])=>{Object.keys(this.relationLineConfigs).some(e=>e===t)?d()(e,this.relationLineConfigs[t].points)||n["default"].set(this.relationLineConfigs,t,Object.assign({},this.relationLineConfigs[t],{points:e})):n["default"].set(this.relationLineConfigs,t,Object.assign({},this.relationLineConfigs[t],{points:e,stroke:this.relWireColor,strokeWidth:this.dragging.state||this.entitySelectedFinal?2:1,lineCap:"round",lineJoin:"round",draggable:!1,closed:!1}))}),Object.keys(this.relationLineConfigs).some(t=>{Object.keys(this.relationWirePoints).includes(t)||n["default"].delete(this.relationLineConfigs,t)})},relWireColor(){Object.entries(this.relationLineConfigs).forEach(([t,e])=>{n["default"].set(this.relationLineConfigs,t,Object.assign({},this.relationLineConfigs[t],{stroke:this.relWireColor}))})},"dragging.state"(){Object.entries(this.relationLineConfigs).forEach(([t,e])=>{n["default"].set(this.relationLineConfigs,t,Object.assign({},this.relationLineConfigs[t],{strokeWidth:this.dragging.state||this.entitySelectedFinal?2:1}))})},entitySelectedFinal(){this.apiValidity&&(d()(this.entitySelectedFinal,this.entityData.viz_props.selected)||this.savePropToAPI("selected",this.entitySelectedFinal)),Object.entries(this.relationLineConfigs).forEach(([t,e])=>{n["default"].set(this.relationLineConfigs,t,Object.assign({},this.relationLineConfigs[t],{strokeWidth:this.dragging.state||this.entitySelectedFinal?2:1}))})},entityLocation_(){this.$emit("setSelfRelSpots",this.relationSpots),this.dragging.state?this.entityLocation=Object.assign({},this.entityLocation_):this.apiValidity&&(d()(this.entityLocation_,this.entityData.viz_props.location)||d()(this.entityLocation_,this.entityLocationDef)&&!d()(this.entityLocationDef,this.entityData.viz_props.location)||this.savePropToAPI("location",this.entityLocation_))},"entityData.viz_props"(){d()(this.entityLocation_,this.entityData.viz_props.location)||(this.entityLocation=Object.assign({},this.entityData.viz_props.location)),this.entityData.viz_props.selected!==this.entitySelectedFinal&&(void 0===this.entitySelectedDef&&(this.entitySelectedDef=this.entityData.viz_props.selected),this.entitySelectedDef&&this.$emit("prevActiveEntityID",this.entityID),this.entitySelectedFinal=this.entityData.viz_props.selected),d()(this.entityColor,this.entityData.viz_props.color)||(this.entityColor=Object.assign({},this.entityData.viz_props.color))},"entityData.source"(){this.entityData.source.Label&&(this.entityLabel=this.entityData.source.Label)},entityLabel(){this.updateEntityBoundaryBox(),this.$emit("setSelfRelSpots",this.relationSpots),this.apiValidity&&r()({method:"POST",url:this.apiUrl+"/entity/updateLabel",params:{entityID:this.entityID},paramsSerializer:h.a.stringify,data:h.a.stringify({Label:this.entityLabel})}).then(()=>{n["default"].set(this.entityData.source,"Label",this.entityLabel),this.autoSave&&r.a.post(this.apiUrl+"/collection/save")})},entityColor:{handler(){d()(this.entityColor,this.entityData.viz_props.color)||this.savePropToAPI("color",this.entityColor)},deep:!0},updateEntityData(){this.updateEntityData&&this.getEntityData()},pressed:{handler(){},deep:!0}},created:function(){},mounted:function(){void 0!==this.entityID&&console.log("@ mounted "+this.entityID),this.getEntityData(),this.updateEntityBoundaryBox(0),this.$store.subscribe((t,e)=>{this.relClaimMode.mode&&"update_relClaimMode"===t.type&&(this.relClaimMode.targetID=e.relClaimMode.targetID,null!==this.relClaimMode.targetID&&this.apiValidity&&this.addRelClaim(),e.relClaimMode.claimantID===this.entityID&&(this.relClaimMode.mode=e.relClaimMode.mode))})},beforeUpdate(){},updated(){}},y=c,g=(i("11ca"),i("2877")),u=Object(g["a"])(y,s,o,!1,null,"a9621a44",null);e["default"]=u.exports}}]);